# DATABASE ARCHITECTURE <!-- omit from toc -->

**Updated:** 09/21/2023

> &nbsp;  
> ⚠️ **`v.0.0.3` ACTIVE DEVELOPMENT** ⚠️  
> _Some parts outdated._ > &nbsp;

- [Visual Diagram](#visual-diagram)
- [Table/Column Details](#tablecolumn-details)
  - [`archive_profiles`](#archive_profiles)
  - [`categories`](#categories)
  - [`entities`](#entities)
  - [`profile_entities`](#profile_entities)
- [SQL Table Definitions](#sql-table-definitions)
  - [SQL: `archive_profiles`](#sql-archive_profiles)
  - [SQL: `categories`](#sql-categories)
  - [SQL: `entities`](#sql-entities)
  - [SQL: `profile_entities`](#sql-profile_entities)

---

## Visual Diagram

The database structure is shown in the visual diagram below along with the data type for each column.

        Auto-Archive
        └── `archive_profiles`
        │   ├── `profile_id` (UUID) (PK)
        │   ├── `profile_title` (text)
        │   ├── `profile_summary` (text)
        │   ├── `profile_text` (text)
        │   ├── `profile_date` (timestamp)
        │   ├── `category_id` (int4) (FK)
        │   └── `profile_embedding` (text)
        ├── `categories`
        │   ├── `category_id` (int4) (PK)
        │   └── `category_name` (text)
        ├── `entities`
        |   ├── `entity_id` (uuid) (PK)
        |   └── `entity_name` (text)
        └── `profile_entities`
            ├── `profile_entity_id` (uuid) (PK)
            ├── `document_id` (uuid) (FK)
            └── `entity_id` (uuid) (FK)

![Diagram showing the Auto-Archive database, tables, table columns, and table relationships. Updated 08/08/2023.](doc_assets/database_structure_08082023.jpg "Auto-Archive Cloud Database Structure, hosted by Supabase. Updated 08/08/2023.")

## Table/Column Details

### `archive_profiles`

The `archive_profiles` table stores most information about each document for their "Archive Profile", such as title, summary, full text, upload date, and category. Specifically, the table has these columns:

- `profile_id`: document ID [PK] [uuid]
- `profile_title`: document title (generated by NLP) [text]
- `profile_summary`: document summary (generated by NLP) [text]
- `profile_text`: full document text [text]
- `profile_date`: upload date/time [timestamp]
- `category_id`: document category (decided by NLP from list in `categories` table) [FK] [int] [serial]
- `profile_embedding`: embeddings (generated using OpenAI API) used for summarization & categorization [text]

### `categories`

The `categories` table stores information about the different categories that documents can be assigned to.

- `category_id`: category ID [PK] [int] [serial]
- `category_name`: cateory name [text]

As of `v.0.1.8`, the `categories` table had 8 rows [`category_id` | `category_name`]:

category_id | category_name
1 | Autobiography
2 | Biography
3 | Journal
4 | Legal
5 | Letter
6 | Minutes
7 | Newspaper
8 | Other

### `entities`

The `entities` table stores information about the different entities that can be found in documents.

- `entity_id`: entity ID [uuid] [PK]
- `entity_name`: entity string [text]
- `entity_type`: entity category [text]

### `profile_entities`

The `profile_entities` table is a junction table that links the `archive_profiles` table to the `entities` table. This table shows all of the document-entity relationships since documents/entities have a 1-to-many relationship.

- `profile_entity_id`: unique ID for each document/entity relationship [uuid] [PK]
- `profile_id`: foreign key [FK] connected to `archive_profiles` > `profile_id` [uuid]
- `entity_id`: foreign key [FK] connected to `entities` > `entity_id` [uuid]

---

## SQL Table Definitions

### SQL: `archive_profiles`

    ``` sql
    create table
    public.archive_profiles (
        profile_id uuid not null default gen_random_uuid (),
        profile_title text null,
        profile_summary text null,
        profile_text text null,
        profile_date timestamp without time zone null,
        category_id integer null,
        profile_embedding text null,
        constraint archive_profiles_pkey primary key (profile_id),
        constraint archive_profiles_category_id_fkey foreign key (category_id) references categories (category_id)
    ) tablespace pg_default;
    ```

### SQL: `categories`

    ``` sql
    create table
    public.categories (
        category_id serial,
        category_name text null,
        constraint categories_pkey primary key (category_id)
    ) tablespace pg_default;
    ```

### SQL: `entities`

    ``` sql
    create table
    public.entities (
        entity_id uuid not null default gen_random_uuid (),
        entity_name text null,
        entity_type text null,
        constraint entities_pkey primary key (entity_id)
    ) tablespace pg_default;
    ```

### SQL: `profile_entities`

    ``` sql
    create table
    public.profile_entities (
        profile_entity_id uuid not null default gen_random_uuid (),
        profile_id uuid null,
        entity_id uuid null,
        constraint profile_entities_pkey primary key (profile_entity_id),
        constraint profile_entities_entity_id_fkey foreign key (entity_id) references entities (entity_id),
        constraint profile_entities_profile_id_fkey foreign key (profile_id) references archive_profiles (profile_id)
    ) tablespace pg_default;
    ```

---
